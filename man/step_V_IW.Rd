% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sampler_steps.R
\name{step_V_IW}
\alias{step_V_IW}
\title{Global update step for the state covariance matrix V}
\usage{
step_V_IW(STV, State, Hyper)
}
\arguments{
\item{STV}{List of starting values and hyperparameters generated by
\code{build_starting_values()}, containing \code{W}
and \code{eta}.}

\item{State}{List containing the current state of the sampler,
including the global matrix \code{A}, the lists \code{Ag} and \code{Sg},
and the current value of \code{V}.}

\item{Hyper}{List of scalar hyperparameters produced by \code{hyper()},
containing in particular \code{w}.}
}
\value{
The \code{State} list updated with a new draw for \code{V}.
}
\description{
Performs the conditional update of the global covariance matrix
\code{V} which regulates pooling. Given the group-specific
coefficient matrices \code{A_g}, their deviations from the global
matrix \code{A}, and the group covariance matrices \code{S_g},
the function computes the posterior parameters of an
inverse-Wishart distribution and samples a new value for \code{V}.
}
\details{
The update follows the inverse-Wishart conditional posterior:
\itemize{
\item The sum of quadratic forms
\eqn{\sum_g (A_g - A) S_g^{-1} (A_g - A)^\top}
accumulates group-level deviations.
\item The posterior scale matrix is
\eqn{W_{\post} = w W + \sum_g (A_g - A) S_g^{-1} (A_g - A)^\top}.
\item The posterior degrees of freedom are
\eqn{\eta_{\post} = \eta + G \cdot \text{ncol}(A)}.
}
All matrices are symmetrized and ridge-stabilized before inversion
to ensure numerical positive-definiteness throughout the computation.
}
\examples{
# Minimal example (requires properly dimensioned objects)
# STV <- build_starting_values(N = 5, K = 10, lag = 2)
# Hyper <- hyper(STV)
# Y_list <- list(matrix(rnorm(50),10,5))
# Z_list <- list(matrix(rnorm(100),10,10))
# State <- init(STV, Y_list, Z_list, Hyper)
# State <- step_V_IW(STV, State, Hyper)

}
